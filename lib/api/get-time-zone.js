"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const request_1 = require("../request");
const ENDPOINT = 'get-time-zone';
/**
 * Map passed request to API request
 */
const getApiRequest = (req) => {
    const { fields } = req;
    if (fields) {
        if (Array.isArray(fields)) {
            return Object.assign({}, req, { fields: fields.join(',') });
        }
        return Object.assign({}, req, { fields });
    }
    return req;
};
/**
 * Convert API time zone detail to return time zone detail record
 */
const mapTimeZoneApiDetailToTimeZoneDetail = (apiDetail) => {
    const { countryCode, countryName, zoneName, abbreviation, gmtOffset, dst, zoneStart, zoneEnd, timestamp, formatted, totalPage, currentPage, } = apiDetail;
    return {
        countryCode,
        countryName,
        zoneName,
        abbreviation,
        gmtOffset,
        zoneStart,
        zoneEnd,
        timestamp,
        formatted,
        totalPage,
        currentPage,
        dst: !!(dst === 1),
    };
};
/**
 * Get time zone detail by zone name
 *
 * See: https://timezonedb.com/references/get-time-zone
 */
exports.getTimeZoneByZone = (cfg, req) => __awaiter(this, void 0, void 0, function* () {
    const tzReq = getApiRequest(Object.assign({}, req, { by: 'zone' }));
    const response = yield request_1.tzdbRequest(cfg, {
        endpoint: ENDPOINT,
        req: tzReq,
    });
    return mapTimeZoneApiDetailToTimeZoneDetail(response);
});
/**
 * Get time zone detail by geo position
 *
 * See: https://timezonedb.com/references/get-time-zone
 */
exports.getTimeZoneByPosition = (cfg, req) => __awaiter(this, void 0, void 0, function* () {
    const tzReq = getApiRequest(Object.assign({}, req, { by: 'position' }));
    const response = yield request_1.tzdbRequest(cfg, {
        endpoint: ENDPOINT,
        req: tzReq,
    });
    return mapTimeZoneApiDetailToTimeZoneDetail(response);
});
/**
 * Get time zone detail by city (premium).
 *
 * NOTE: The return value of this HAS NOT BEEN VERIFIED and this could be completely broken.
 *
 * See: https://timezonedb.com/references/get-time-zone
 */
exports.getTimeZoneByCity = (cfg, req) => __awaiter(this, void 0, void 0, function* () {
    const tzReq = getApiRequest(Object.assign({}, req, { by: 'city' }));
    const response = yield request_1.tzdbRequest(cfg, {
        endpoint: ENDPOINT,
        req: tzReq,
    });
    return response.zones.map(mapTimeZoneApiDetailToTimeZoneDetail);
});
/**
 * Get time zone detail by IP (premium).
 *
 * NOTE: The return value of this HAS NOT BEEN VERIFIED and this could be completely broken.
 *
 * See: https://timezonedb.com/references/get-time-zone
 */
exports.getTimeZoneByIP = (cfg, req) => __awaiter(this, void 0, void 0, function* () {
    const tzReq = getApiRequest(Object.assign({}, req, { by: 'ip' }));
    const response = yield request_1.tzdbRequest(cfg, {
        endpoint: ENDPOINT,
        req: tzReq,
    });
    return mapTimeZoneApiDetailToTimeZoneDetail(response);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0LXRpbWUtem9uZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcGkvZ2V0LXRpbWUtem9uZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQ0Esd0NBQXNEO0FBRXRELE1BQU0sUUFBUSxHQUFHLGVBQWUsQ0FBQztBQXVQakM7O0dBRUc7QUFDSCxNQUFNLGFBQWEsR0FBRyxDQUFDLEdBQW9ELEVBQXlCLEVBQUU7SUFDcEcsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQztJQUV2QixJQUFJLE1BQU0sRUFBRTtRQUNWLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUN6Qix5QkFBWSxHQUFHLElBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUc7U0FDN0M7UUFFRCx5QkFBWSxHQUFHLElBQUUsTUFBTSxJQUFHO0tBQzNCO0lBRUQsT0FBK0IsR0FBRyxDQUFDO0FBQ3JDLENBQUMsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxvQ0FBb0MsR0FBRyxDQUFDLFNBQTRCLEVBQWtCLEVBQUU7SUFDNUYsTUFBTSxFQUNKLFdBQVcsRUFDWCxXQUFXLEVBQ1gsUUFBUSxFQUNSLFlBQVksRUFDWixTQUFTLEVBQ1QsR0FBRyxFQUNILFNBQVMsRUFDVCxPQUFPLEVBQ1AsU0FBUyxFQUNULFNBQVMsRUFDVCxTQUFTLEVBQ1QsV0FBVyxHQUNaLEdBQUcsU0FBUyxDQUFDO0lBRWQsT0FBTztRQUNMLFdBQVc7UUFDWCxXQUFXO1FBQ1gsUUFBUTtRQUNSLFlBQVk7UUFDWixTQUFTO1FBQ1QsU0FBUztRQUNULE9BQU87UUFDUCxTQUFTO1FBQ1QsU0FBUztRQUNULFNBQVM7UUFDVCxXQUFXO1FBQ1gsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7S0FDbkIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDVSxRQUFBLGlCQUFpQixHQUFHLENBQU8sR0FBZSxFQUFFLEdBQTZCLEVBQTJCLEVBQUU7SUFDakgsTUFBTSxLQUFLLEdBQTBCLGFBQWEsbUJBQU0sR0FBRyxJQUFFLEVBQUUsRUFBRSxNQUFNLElBQUcsQ0FBQztJQUUzRSxNQUFNLFFBQVEsR0FBOEIsTUFBTSxxQkFBVyxDQUE0QixHQUFHLEVBQUU7UUFDNUYsUUFBUSxFQUFFLFFBQVE7UUFDbEIsR0FBRyxFQUFFLEtBQUs7S0FDWCxDQUFDLENBQUM7SUFFSCxPQUFPLG9DQUFvQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3hELENBQUMsQ0FBQSxDQUFDO0FBRUY7Ozs7R0FJRztBQUNVLFFBQUEscUJBQXFCLEdBQUcsQ0FBTyxHQUFlLEVBQUUsR0FBaUMsRUFBMkIsRUFBRTtJQUN6SCxNQUFNLEtBQUssR0FBMEIsYUFBYSxtQkFBTSxHQUFHLElBQUUsRUFBRSxFQUFFLFVBQVUsSUFBRyxDQUFDO0lBRS9FLE1BQU0sUUFBUSxHQUE4QixNQUFNLHFCQUFXLENBQTRCLEdBQUcsRUFBRTtRQUM1RixRQUFRLEVBQUUsUUFBUTtRQUNsQixHQUFHLEVBQUUsS0FBSztLQUNYLENBQUMsQ0FBQztJQUVILE9BQU8sb0NBQW9DLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDeEQsQ0FBQyxDQUFBLENBQUM7QUFFRjs7Ozs7O0dBTUc7QUFDVSxRQUFBLGlCQUFpQixHQUFHLENBQU8sR0FBZSxFQUFFLEdBQTZCLEVBQTZCLEVBQUU7SUFDbkgsTUFBTSxLQUFLLEdBQTBCLGFBQWEsbUJBQU0sR0FBRyxJQUFFLEVBQUUsRUFBRSxNQUFNLElBQUcsQ0FBQztJQUUzRSxNQUFNLFFBQVEsR0FBZ0MsTUFBTSxxQkFBVyxDQUE4QixHQUFHLEVBQUU7UUFDaEcsUUFBUSxFQUFFLFFBQVE7UUFDbEIsR0FBRyxFQUFFLEtBQUs7S0FDWCxDQUFDLENBQUM7SUFFSCxPQUFPLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7QUFDbEUsQ0FBQyxDQUFBLENBQUM7QUFFRjs7Ozs7O0dBTUc7QUFDVSxRQUFBLGVBQWUsR0FBRyxDQUFPLEdBQWUsRUFBRSxHQUEyQixFQUEyQixFQUFFO0lBQzdHLE1BQU0sS0FBSyxHQUEwQixhQUFhLG1CQUFNLEdBQUcsSUFBRSxFQUFFLEVBQUUsSUFBSSxJQUFHLENBQUM7SUFFekUsTUFBTSxRQUFRLEdBQThCLE1BQU0scUJBQVcsQ0FBNEIsR0FBRyxFQUFFO1FBQzVGLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLEdBQUcsRUFBRSxLQUFLO0tBQ1gsQ0FBQyxDQUFDO0lBRUgsT0FBTyxvQ0FBb0MsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN4RCxDQUFDLENBQUEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRaREJDb25maWcgfSBmcm9tICcuLi9jb25maWcnO1xuaW1wb3J0IHsgdHpkYlJlcXVlc3QsIEFwaVJlc3BvbnNlIH0gZnJvbSAnLi4vcmVxdWVzdCc7XG5cbmNvbnN0IEVORFBPSU5UID0gJ2dldC10aW1lLXpvbmUnO1xuXG4vKipcbiAqIFZhbGlkIGJ5IGZpZWxkc1xuICovXG5pbnRlcmZhY2UgR2V0VGltZVpvbmVSZXF1ZXN0Qnkge1xuICBieTogJ3pvbmUnIHwgJ3Bvc2l0aW9uJyB8ICdjaXR5JyB8ICdpcCc7XG59XG5cbi8qKlxuICogQSByZXF1ZXN0IHRvIHRoZSBcIi9nZXQtdGltZS16b25lXCIgZW5kcG9pbnRcbiAqL1xuaW50ZXJmYWNlIEdldFRpbWVab25lUmVxdWVzdENvbW1vbiB7XG4gIC8qKlxuICAgKiBDdXN0b21pemUgdGhlIGZpZWxkcyB0byBkaXNwbGF5IGluIHJlc3BvbnNlLiBVc2UgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvciBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmdcbiAgICpcbiAgICogT3B0aW9ucyBpbmNsdWRlOlxuICAgKlxuICAgKiBjb3VudHJ5Q29kZSwgY291bnRyeU5hbWUsIHJlZ2lvbk5hbWUsIGNpdHlOYW1lLCB6b25lTmFtZSwgYWJicmV2aWF0aW9uLCBnbXRPZmZzZXQsXG4gICAqIGRzdCwgem9uZVN0YXJ0LCB6b25lRW5kLCBuZXh0QWJicmV2aWF0aW9uLCB0aW1lc3RhbXAsIGZvcm1hdHRlZCwgYWxsIChkZWZhdWx0KVxuICAgKlxuICAgKiBTZWU6IGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9nZXQtdGltZS16b25lXG4gICAqL1xuICBmaWVsZHM/OiBzdHJpbmcgfCAoa2V5b2YgVGltZVpvbmVBcGlEZXRhaWwpW107XG5cbiAgLyoqXG4gICAqIE5hdmlnYXRlIHRvIG90aGVyIHBhZ2Ugd2hlbiByZXN1bHQgaXMgbW9yZSB0aGFuIDI1IHJlY29yZHNcbiAgICpcbiAgICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICAgKi9cbiAgcGFnZT86IG51bWJlcjtcblxuICAvKipcbiAgICogVW5peCB0aW1lIGluIFVUQyB0byByZXRyaWV2ZSB6b25lIGluZm9ybWF0aW9uIGZvciAodXNlZCBmb3IgY2FsY3VsYXRpbmcgb2Zmc2V0cyBhdCBhIHBhcnRpY3VsYXIgdGltZSlcbiAgICpcbiAgICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICAgKi9cbiAgdGltZT86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBMb29rIHVwIGRldGFpbGVkIHpvbmUgaW5mb3JtYXRpb24gYnkgcHJvdmlkaW5nIGEgem9uZSBuYW1lIChmcmVlKVxuICpcbiAqIFNlZTogaHR0cHM6Ly90aW1lem9uZWRiLmNvbS9yZWZlcmVuY2VzL2dldC10aW1lLXpvbmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHZXRUaW1lWm9uZVJlcXVlc3RCeVpvbmUgZXh0ZW5kcyBHZXRUaW1lWm9uZVJlcXVlc3RDb21tb24ge1xuICAvKipcbiAgICogQSB0aW1lIHpvbmUgYWJicmV2aWF0aW9uIG9yIHRpbWUgem9uZSBuYW1lXG4gICAqXG4gICAqIFNlZTogaHR0cHM6Ly90aW1lem9uZWRiLmNvbS9yZWZlcmVuY2VzL2dldC10aW1lLXpvbmVcbiAgICovXG4gIHpvbmU6IHN0cmluZztcbn1cblxuLyoqXG4gKiBMb29rIHVwIGRldGFpbGVkIHpvbmUgaW5mb3JtYXRpb24gYnkgcHJvdmlkaW5nIGEgbGF0aXR1ZGUgYW5kIGxvbmdpdHVkZSAoZnJlZSlcbiAqXG4gKiBTZWU6IGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9nZXQtdGltZS16b25lXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgR2V0VGltZVpvbmVSZXF1ZXN0QnlQb3NpdGlvbiBleHRlbmRzIEdldFRpbWVab25lUmVxdWVzdENvbW1vbiB7XG4gIC8qKlxuICAgKiBMYXRpdHVkZSBvZiBhIGNpdHlcbiAgICpcbiAgICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICAgKi9cbiAgbGF0OiBudW1iZXIgfCBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIExvbmdpdHVkZSBvZiBhIGNpdHlcbiAgICpcbiAgICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICAgKi9cbiAgbG5nOiBudW1iZXIgfCBzdHJpbmc7XG59XG5cbi8qKlxuICogTG9vayB1cCBkZXRhaWxlZCB6b25lIGluZm9ybWF0aW9uIGJ5IHByb3ZpZGluZyBhIGNpdHkgKHByZW1pdW0pXG4gKlxuICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEdldFRpbWVab25lUmVxdWVzdEJ5Q2l0eSBleHRlbmRzIEdldFRpbWVab25lUmVxdWVzdENvbW1vbiB7XG4gIC8qKlxuICAgKiBBIHZhbGlkIElTTyAzMTY2IGNvdW50cnkgY29kZVxuICAgKlxuICAgKiBTZWU6IGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9nZXQtdGltZS16b25lXG4gICAqL1xuICBjb3VudHJ5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIGEgY2l0eS4gVXNlIGFzdGVyaXNrICgqKSBmb3Igd2lsZGNhcmQgc2VhcmNoLlxuICAgKlxuICAgKiBTZWU6IGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9nZXQtdGltZS16b25lXG4gICAqL1xuICBjaXR5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEEgdmFsaWQgcmVnaW9uIGNvZGUgb2YgVW5pdGVkIFN0YXRlc1xuICAgKlxuICAgKiBTZWU6IGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9nZXQtdGltZS16b25lXG4gICAqL1xuICByZWdpb24/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogTG9vayB1cCBkZXRhaWxlZCB6b25lIGluZm9ybWF0aW9uIGJ5IHByb3ZpZGluZyBhbiBJUCBhZGRyZXNzIChwcmVtaXVtKVxuICpcbiAqIFNlZTogaHR0cHM6Ly90aW1lem9uZWRiLmNvbS9yZWZlcmVuY2VzL2dldC10aW1lLXpvbmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHZXRUaW1lWm9uZVJlcXVlc3RCeUlQIGV4dGVuZHMgR2V0VGltZVpvbmVSZXF1ZXN0Q29tbW9uIHtcbiAgLyoqXG4gICAqIEEgdmFsaWQgSVAgYWRkcmVzc1xuICAgKlxuICAgKiBTZWU6IGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9nZXQtdGltZS16b25lXG4gICAqL1xuICBpcDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFJlcXVlc3QgdGhhdCBnZXRzIHNlbnQgdG8gdGhlIEFQSSBmb3IgYSBnZXQtdGltZS16b25lIHJlcXVlc3RcbiAqL1xuaW50ZXJmYWNlIEdldFRpbWVab25lQXBpUmVxdWVzdCBleHRlbmRzIEdldFRpbWVab25lUmVxdWVzdEJ5IHtcbiAgZmllbGRzPzogc3RyaW5nO1xuICB6b25lPzogc3RyaW5nO1xuICBsYXQ/OiBzdHJpbmc7XG4gIGxuZz86IHN0cmluZztcbiAgY291bnRyeT86IHN0cmluZztcbiAgY2l0eT86IHN0cmluZztcbiAgcmVnaW9uPzogc3RyaW5nO1xuICBwYWdlPzogbnVtYmVyO1xuICB0aW1lPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIFRpbWUgem9uZSBpbmZvcm1hdGlvblxuICpcbiAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRpbWVab25lRGV0YWlsIHtcbiAgLyoqXG4gICAqIENvdW50cnkgY29kZSBvZiB0aGUgdGltZSB6b25lXG4gICAqXG4gICAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvbGlzdC10aW1lLXpvbmVcbiAgICovXG4gIGNvdW50cnlDb2RlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIENvdW50cnkgbmFtZSBvZiB0aGUgdGltZSB6b25lXG4gICAqXG4gICAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvbGlzdC10aW1lLXpvbmVcbiAgICovXG4gIGNvdW50cnlOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB0aW1lIHpvbmUgbmFtZVxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly90aW1lem9uZWRiLmNvbS9yZWZlcmVuY2VzL2xpc3QtdGltZS16b25lXG4gICAqL1xuICB6b25lTmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBYmJyZXZpYXRpb24gb2YgdGhlIHRpbWUgem9uZVxuICAgKi9cbiAgYWJicmV2aWF0aW9uOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB0aW1lIG9mZnNldCBpbiBzZWNvbmRzIGJhc2VkIG9uIFVUQyB0aW1lXG4gICAqXG4gICAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvbGlzdC10aW1lLXpvbmVcbiAgICovXG4gIGdtdE9mZnNldDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSB0aW1lIHpvbmUgaXMgaW4gRFNUIGF0IHRoZSB0aW1lc3RhbXBcbiAgICpcbiAgICogU2VlIGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9saXN0LXRpbWUtem9uZVxuICAgKi9cbiAgZHN0OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5peCB0aW1lIGluIFVUQyB3aGVuIGN1cnJlbnQgdGltZSB6b25lIHN0YXJ0IChpLmUuIHN0YXJ0IG9mIGN1cnJlbnQgRFNUIC8gbm9uLURTVCBwZXJpb2QpXG4gICAqXG4gICAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvbGlzdC10aW1lLXpvbmVcbiAgICovXG4gIHpvbmVTdGFydDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgdW5peCB0aW1lIGluIFVUQyB3aGVuIGN1cnJlbnQgdGltZSB6b25lIHN0YXJ0IChpLmUuIHN0YXJ0IG9mIGN1cnJlbnQgRFNUIC8gbm9uLURTVCBwZXJpb2QpXG4gICAqXG4gICAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvbGlzdC10aW1lLXpvbmVcbiAgICovXG4gIHpvbmVFbmQ6IG51bWJlcjtcblxuICAvKipcbiAgICogQ3VycmVudCBsb2NhbCB0aW1lIGluIHVuaXggdGltZS4gU3VidHJhY3QgYGdtdE9mZnNldGAgdG8gZ2V0IFVUQyB0aW1lXG4gICAqXG4gICAqIFNlZSBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvbGlzdC10aW1lLXpvbmVcbiAgICovXG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBGb3JtYXR0ZWQgdGltZXN0YW1wIGluIGBZLW0tZCBoOmk6c2AgZm9ybWF0IChlLmcuIGAyMDE5LTAzLTI5IDAzOjU2OjI3YClcbiAgICpcbiAgICogU2VlIGh0dHBzOi8vdGltZXpvbmVkYi5jb20vcmVmZXJlbmNlcy9saXN0LXRpbWUtem9uZVxuICAgKi9cbiAgZm9ybWF0dGVkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSB0b3RhbCBudW1iZXIgb2YgcGFnZXMgaWYgcmVzdWx0cyBleGNlZWQgMjVcbiAgICovXG4gIHRvdGFsUGFnZT86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIGN1cnJlbnQgcGFnZSB3aGVuIHJlc3VsdHMgZXhjZWVkIDI1XG4gICAqL1xuICBjdXJyZW50UGFnZT86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBBUEkgdGltZXpvbmUgZGV0YWlsIHJlY29yZFxuICovXG5pbnRlcmZhY2UgVGltZVpvbmVBcGlEZXRhaWwge1xuICBjb3VudHJ5Q29kZTogc3RyaW5nO1xuICBjb3VudHJ5TmFtZTogc3RyaW5nO1xuICB6b25lTmFtZTogc3RyaW5nO1xuICBhYmJyZXZpYXRpb246IHN0cmluZztcbiAgZ210T2Zmc2V0OiBudW1iZXI7XG4gIGRzdDogMCB8IDE7XG4gIHpvbmVTdGFydDogbnVtYmVyO1xuICB6b25lRW5kOiBudW1iZXI7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBmb3JtYXR0ZWQ6IHN0cmluZztcbiAgdG90YWxQYWdlPzogbnVtYmVyO1xuICBjdXJyZW50UGFnZT86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBSZXNwb25zZSBmcm9tIHRoZSBBUEkgZm9yIGEgZ2V0LXRpbWUtem9uZSByZXF1ZXN0IHdoZXJlIG9uZSB6b25lIGlzIHJldHVybmVkXG4gKi9cbmludGVyZmFjZSBHZXRUaW1lWm9uZVJlc3BvbnNlU2luZ2xlIGV4dGVuZHMgQXBpUmVzcG9uc2UsIFRpbWVab25lQXBpRGV0YWlsIHt9XG5cbi8qKlxuICogUmVzcG9uc2UgZnJvbSB0aGUgQVBJIGZvciBhIGdldC10aW1lLXpvbmUgcmVxdWVzdCB3aGVyZSBtdWx0aXBsZSB6b25lcyBhcmUgcmV0dXJuZWRcbiAqL1xuaW50ZXJmYWNlIEdldFRpbWVab25lUmVzcG9uc2VNdWx0aXBsZSBleHRlbmRzIEFwaVJlc3BvbnNlIHtcbiAgem9uZXM6IFRpbWVab25lQXBpRGV0YWlsW107XG59XG5cbi8qKlxuICogTWFwIHBhc3NlZCByZXF1ZXN0IHRvIEFQSSByZXF1ZXN0XG4gKi9cbmNvbnN0IGdldEFwaVJlcXVlc3QgPSAocmVxOiBHZXRUaW1lWm9uZVJlcXVlc3RDb21tb24gJiBHZXRUaW1lWm9uZVJlcXVlc3RCeSk6IEdldFRpbWVab25lQXBpUmVxdWVzdCA9PiB7XG4gIGNvbnN0IHsgZmllbGRzIH0gPSByZXE7XG5cbiAgaWYgKGZpZWxkcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGZpZWxkcykpIHtcbiAgICAgIHJldHVybiB7IC4uLnJlcSwgZmllbGRzOiBmaWVsZHMuam9pbignLCcpIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgLi4ucmVxLCBmaWVsZHMgfTtcbiAgfVxuXG4gIHJldHVybiA8R2V0VGltZVpvbmVBcGlSZXF1ZXN0PiByZXE7XG59O1xuXG4vKipcbiAqIENvbnZlcnQgQVBJIHRpbWUgem9uZSBkZXRhaWwgdG8gcmV0dXJuIHRpbWUgem9uZSBkZXRhaWwgcmVjb3JkXG4gKi9cbmNvbnN0IG1hcFRpbWVab25lQXBpRGV0YWlsVG9UaW1lWm9uZURldGFpbCA9IChhcGlEZXRhaWw6IFRpbWVab25lQXBpRGV0YWlsKTogVGltZVpvbmVEZXRhaWwgPT4ge1xuICBjb25zdCB7XG4gICAgY291bnRyeUNvZGUsXG4gICAgY291bnRyeU5hbWUsXG4gICAgem9uZU5hbWUsXG4gICAgYWJicmV2aWF0aW9uLFxuICAgIGdtdE9mZnNldCxcbiAgICBkc3QsXG4gICAgem9uZVN0YXJ0LFxuICAgIHpvbmVFbmQsXG4gICAgdGltZXN0YW1wLFxuICAgIGZvcm1hdHRlZCxcbiAgICB0b3RhbFBhZ2UsXG4gICAgY3VycmVudFBhZ2UsXG4gIH0gPSBhcGlEZXRhaWw7XG5cbiAgcmV0dXJuIHtcbiAgICBjb3VudHJ5Q29kZSxcbiAgICBjb3VudHJ5TmFtZSxcbiAgICB6b25lTmFtZSxcbiAgICBhYmJyZXZpYXRpb24sXG4gICAgZ210T2Zmc2V0LFxuICAgIHpvbmVTdGFydCxcbiAgICB6b25lRW5kLFxuICAgIHRpbWVzdGFtcCxcbiAgICBmb3JtYXR0ZWQsXG4gICAgdG90YWxQYWdlLFxuICAgIGN1cnJlbnRQYWdlLFxuICAgIGRzdDogISEoZHN0ID09PSAxKSxcbiAgfTtcbn07XG5cbi8qKlxuICogR2V0IHRpbWUgem9uZSBkZXRhaWwgYnkgem9uZSBuYW1lXG4gKlxuICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICovXG5leHBvcnQgY29uc3QgZ2V0VGltZVpvbmVCeVpvbmUgPSBhc3luYyAoY2ZnOiBUWkRCQ29uZmlnLCByZXE6IEdldFRpbWVab25lUmVxdWVzdEJ5Wm9uZSk6IFByb21pc2U8VGltZVpvbmVEZXRhaWw+ID0+IHtcbiAgY29uc3QgdHpSZXE6IEdldFRpbWVab25lQXBpUmVxdWVzdCA9IGdldEFwaVJlcXVlc3QoeyAuLi5yZXEsIGJ5OiAnem9uZScgfSk7XG5cbiAgY29uc3QgcmVzcG9uc2U6IEdldFRpbWVab25lUmVzcG9uc2VTaW5nbGUgPSBhd2FpdCB0emRiUmVxdWVzdDxHZXRUaW1lWm9uZVJlc3BvbnNlU2luZ2xlPihjZmcsIHtcbiAgICBlbmRwb2ludDogRU5EUE9JTlQsXG4gICAgcmVxOiB0elJlcSxcbiAgfSk7XG5cbiAgcmV0dXJuIG1hcFRpbWVab25lQXBpRGV0YWlsVG9UaW1lWm9uZURldGFpbChyZXNwb25zZSk7XG59O1xuXG4vKipcbiAqIEdldCB0aW1lIHpvbmUgZGV0YWlsIGJ5IGdlbyBwb3NpdGlvblxuICpcbiAqIFNlZTogaHR0cHM6Ly90aW1lem9uZWRiLmNvbS9yZWZlcmVuY2VzL2dldC10aW1lLXpvbmVcbiAqL1xuZXhwb3J0IGNvbnN0IGdldFRpbWVab25lQnlQb3NpdGlvbiA9IGFzeW5jIChjZmc6IFRaREJDb25maWcsIHJlcTogR2V0VGltZVpvbmVSZXF1ZXN0QnlQb3NpdGlvbik6IFByb21pc2U8VGltZVpvbmVEZXRhaWw+ID0+IHtcbiAgY29uc3QgdHpSZXE6IEdldFRpbWVab25lQXBpUmVxdWVzdCA9IGdldEFwaVJlcXVlc3QoeyAuLi5yZXEsIGJ5OiAncG9zaXRpb24nIH0pO1xuXG4gIGNvbnN0IHJlc3BvbnNlOiBHZXRUaW1lWm9uZVJlc3BvbnNlU2luZ2xlID0gYXdhaXQgdHpkYlJlcXVlc3Q8R2V0VGltZVpvbmVSZXNwb25zZVNpbmdsZT4oY2ZnLCB7XG4gICAgZW5kcG9pbnQ6IEVORFBPSU5ULFxuICAgIHJlcTogdHpSZXEsXG4gIH0pO1xuXG4gIHJldHVybiBtYXBUaW1lWm9uZUFwaURldGFpbFRvVGltZVpvbmVEZXRhaWwocmVzcG9uc2UpO1xufTtcblxuLyoqXG4gKiBHZXQgdGltZSB6b25lIGRldGFpbCBieSBjaXR5IChwcmVtaXVtKS5cbiAqXG4gKiBOT1RFOiBUaGUgcmV0dXJuIHZhbHVlIG9mIHRoaXMgSEFTIE5PVCBCRUVOIFZFUklGSUVEIGFuZCB0aGlzIGNvdWxkIGJlIGNvbXBsZXRlbHkgYnJva2VuLlxuICpcbiAqIFNlZTogaHR0cHM6Ly90aW1lem9uZWRiLmNvbS9yZWZlcmVuY2VzL2dldC10aW1lLXpvbmVcbiAqL1xuZXhwb3J0IGNvbnN0IGdldFRpbWVab25lQnlDaXR5ID0gYXN5bmMgKGNmZzogVFpEQkNvbmZpZywgcmVxOiBHZXRUaW1lWm9uZVJlcXVlc3RCeUNpdHkpOiBQcm9taXNlPFRpbWVab25lRGV0YWlsW10+ID0+IHtcbiAgY29uc3QgdHpSZXE6IEdldFRpbWVab25lQXBpUmVxdWVzdCA9IGdldEFwaVJlcXVlc3QoeyAuLi5yZXEsIGJ5OiAnY2l0eScgfSk7XG5cbiAgY29uc3QgcmVzcG9uc2U6IEdldFRpbWVab25lUmVzcG9uc2VNdWx0aXBsZSA9IGF3YWl0IHR6ZGJSZXF1ZXN0PEdldFRpbWVab25lUmVzcG9uc2VNdWx0aXBsZT4oY2ZnLCB7XG4gICAgZW5kcG9pbnQ6IEVORFBPSU5ULFxuICAgIHJlcTogdHpSZXEsXG4gIH0pO1xuXG4gIHJldHVybiByZXNwb25zZS56b25lcy5tYXAobWFwVGltZVpvbmVBcGlEZXRhaWxUb1RpbWVab25lRGV0YWlsKTtcbn07XG5cbi8qKlxuICogR2V0IHRpbWUgem9uZSBkZXRhaWwgYnkgSVAgKHByZW1pdW0pLlxuICpcbiAqIE5PVEU6IFRoZSByZXR1cm4gdmFsdWUgb2YgdGhpcyBIQVMgTk9UIEJFRU4gVkVSSUZJRUQgYW5kIHRoaXMgY291bGQgYmUgY29tcGxldGVseSBicm9rZW4uXG4gKlxuICogU2VlOiBodHRwczovL3RpbWV6b25lZGIuY29tL3JlZmVyZW5jZXMvZ2V0LXRpbWUtem9uZVxuICovXG5leHBvcnQgY29uc3QgZ2V0VGltZVpvbmVCeUlQID0gYXN5bmMgKGNmZzogVFpEQkNvbmZpZywgcmVxOiBHZXRUaW1lWm9uZVJlcXVlc3RCeUlQKTogUHJvbWlzZTxUaW1lWm9uZURldGFpbD4gPT4ge1xuICBjb25zdCB0elJlcTogR2V0VGltZVpvbmVBcGlSZXF1ZXN0ID0gZ2V0QXBpUmVxdWVzdCh7IC4uLnJlcSwgYnk6ICdpcCcgfSk7XG5cbiAgY29uc3QgcmVzcG9uc2U6IEdldFRpbWVab25lUmVzcG9uc2VTaW5nbGUgPSBhd2FpdCB0emRiUmVxdWVzdDxHZXRUaW1lWm9uZVJlc3BvbnNlU2luZ2xlPihjZmcsIHtcbiAgICBlbmRwb2ludDogRU5EUE9JTlQsXG4gICAgcmVxOiB0elJlcSxcbiAgfSk7XG5cbiAgcmV0dXJuIG1hcFRpbWVab25lQXBpRGV0YWlsVG9UaW1lWm9uZURldGFpbChyZXNwb25zZSk7XG59O1xuIl19